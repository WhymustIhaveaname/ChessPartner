# ChessPartner

### 机械层次(不含抓手):
   * 机械部分由底座，大小臂，两个驱动电机，阻尼器和抓手组成
   * 大小臂我们做了两版，第一版着重强调了强度但是过于笨重，于是又改进为轻巧的第二版，为了加强机械臂与电机之间的连接，我们特地3D打印了电机抱箍（在机械臂下侧）[配图:两版机械臂，抱箍.jpg]
   * 由于电机经常抖动和走过之后多转一圈，我们特别设计了电机阻尼器 [配图:阻尼器.jpg]

### 硬件接口层:
   * 两个电机用RS485串口通讯，通过RS485转usb转换器连接到电脑上，在电脑中调用pySerial库进行底层读写 [配图:processon上最上面一张]
   * 抓手的得问茆峻，我猜是通过usb连接kenblocks再通过kenblocks控制上下和抓握

### 控制程序:
   * 控制程序会根据当前电机的位置和速度自动选择最快的路径和其他控制参数（旋转方向，速度等），并且能避开程序中设置的“不可通过区域”
   * 控制程序包含一个守护进程，负责在电机工作异常时予以纠正，在出现重大问题时紧急停机和巨大外力改变了机械臂位形时重新规划路径
   * 为了与视觉识别和下棋程序沟通，控制程序有一个服务器进程，在本机的12599端口监听TCP连接，并根据发来的指令进行操作，通信协议大致为：
       ###### 客户端
       命令|                  含义|           举例
       ---|---------------------|---------------
       "[abcdefgh][12345678]"| 移动到这个位置|  "a1" 就是移动到a1
       "x1"|                  放下抓手，抓握，升起抓手|
       "x2"|                  放下抓手，松开，升起抓手|
       "exit"|                 退出|
       ###### 服务器端响应
       命令|                  含义|           举例
       ---|---------------------|---------------
       "success:命令"|“命令” 执行成功|  "success:a1"已经移到a1
       "byebye"|收到exit之后的返回，之后关闭tcp连接|
       error:信息"|      发生了错误|
   * 既然有控制进程（控制程序主进程），守护进程和服务器进程，所以控制程序使用了多线程的技术，并且由于RS485在一个时刻只能为一个进程所用，所以控制程序还会涉及到复杂的加锁解锁问题

### 下棋程序
   * 下棋程序负责根据现有局面，决定下一步走什么
   * 基本的思路是 alpha-beta 剪枝算法[配图:随便google一张]
   * alpha-beta 剪枝算法需要一个启发函数用以衡量每方的强弱，我们采用的是局面子力和控制棋盘格数的线性叠加：无数对局的经验表明，子力强弱可以用给每个子赋以不同的分值的方法很好的表示，具体而言，兵1分，马象3分，车5分，后9分，王由于不能被杀死，所以应当被赋予一个很大的数。为了在子力一致的情况下反映“局面”的好坏，我们决定把当前所控制的棋盘的格子数乘上一个不大的比例系数加到启发函数中。
     有趣的是，google的Alpha-Zero采用神经网络拟合启发函数，在完全不依赖人类经验的情况下，得到了与我们经验的分值极为接近的结论。
